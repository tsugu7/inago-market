# inago-market 設計ドキュメント

## アーキテクチャ概要

inago-marketは、クライアント-サーバーアーキテクチャを採用したWebアプリケーションです。フロントエンドはReactとD3.jsを使用し、バックエンドはNode.jsとExpress.jsで構築されています。リアルタイムデータの通信にはSocket.IOを使用しています。

```
+----------------+        WebSocket        +----------------+
|                |<----------------------->|                |
|  クライアント   |                         |   サーバー     |
|  (React, D3.js) |        HTTP/REST        |  (Node.js,    |
|                |<----------------------->|   Express)     |
+----------------+                         +----------------+
                                                  |
                                                  | HTTP/REST
                                                  v
                                           +----------------+
                                           |                |
                                           | ProjectX API   |
                                           | (外部サービス)  |
                                           |                |
                                           +----------------+
```

## コンポーネント設計

### フロントエンド

#### コンポーネント階層

```
App
├── ContractSelector
├── VolumeChart
└── ContractGrid
    └── ContractCard (暗黙的)
```

#### 状態管理

Appコンポーネントが主要な状態を管理し、子コンポーネントにpropsとして渡します：

- `selectedContract`: 現在選択されている契約ID
- `contracts`: すべての契約データの配列
- `volumeData`: 出来高チャート用のデータ配列
- `socket`: WebSocket接続オブジェクト
- `availableContracts`: 利用可能な契約のリスト

#### データフロー

1. WebSocketを通じてサーバーからデータを受信
2. Appコンポーネントの状態を更新
3. 更新された状態を子コンポーネントに渡す
4. 子コンポーネントが再レンダリング

### バックエンド

#### サーバーコンポーネント

- **Express.jsサーバー**: HTTPリクエストの処理
- **Socket.IOサーバー**: WebSocket接続の管理
- **モックデータジェネレーター**: デモ用のデータ生成

#### エンドポイント

- **GET /**: メインのHTMLページを提供
- **GET /api/contracts**: 利用可能な契約のリストを返す
- **WebSocket**: リアルタイムデータの配信

#### データモデル

**契約データ**:
```javascript
{
  id: String,         // 契約ID (例: 'ES')
  name: String,       // 契約名 (例: 'E-mini S&P 500')
  price: Number,      // 現在価格
  cumulativeVolume: Number, // 累積出来高
  isPositive: Boolean // 出来高の符号（正/負）
}
```

**出来高データ**:
```javascript
{
  timestamp: Number,  // タイムスタンプ (ミリ秒)
  volume: Number      // 出来高
}
```

## 技術的詳細

### フロントエンド

- **React**: UIコンポーネントの構築
- **D3.js**: データ可視化（チャート）
- **Socket.IO-client**: WebSocketクライアント
- **Webpack**: モジュールバンドラー
- **Babel**: JSトランスパイラー

### バックエンド

- **Node.js**: サーバーランタイム
- **Express.js**: Webフレームワーク
- **Socket.IO**: WebSocketサーバー
- **CORS**: クロスオリジンリクエスト対応

## 拡張性と将来の開発

### スケーラビリティ

- **水平スケーリング**: 複数のサーバーインスタンスを使用
- **キャッシュ**: 頻繁にアクセスされるデータのキャッシュ
- **データベース統合**: 永続的なデータストレージ

### 将来の機能

1. **ユーザー認証**:
   - JWT認証の実装
   - ユーザープロファイル管理

2. **追加のチャートタイプ**:
   - ローソク足チャート
   - ラインチャート
   - ヒートマップ

3. **注文機能**:
   - 注文フォーム
   - 注文履歴
   - ポジション管理

4. **アラート機能**:
   - 価格アラート
   - 出来高アラート
   - プッシュ通知

5. **モバイル対応**:
   - レスポンシブデザインの強化
   - PWA（Progressive Web App）対応
   - ネイティブアプリ開発

## パフォーマンス最適化

1. **フロントエンド**:
   - コード分割
   - レンダリングの最適化
   - メモ化

2. **バックエンド**:
   - データ圧縮
   - バッチ処理
   - キャッシュ戦略

## セキュリティ考慮事項

1. **認証と認可**:
   - JWTベースの認証
   - ロールベースのアクセス制御

2. **データ保護**:
   - HTTPS通信
   - データの暗号化
   - 入力検証

3. **API保護**:
   - レート制限
   - CORS設定
   - CSP（Content Security Policy）
